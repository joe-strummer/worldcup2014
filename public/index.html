<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="http://momentjs.com/downloads/moment.min.js"></script>
<script>
var todaysMatchesJsonObject, todaysMatches;

var countryMapper = {
'Italy': 'Stefan',
'Portugal':'James Hayes',
'USA':'Nuthan',
'Colombia':'Loz',
'Costa Rica':'Aman',
'Uruguay':'John Payne',
'Japan':'James Cade',
'Belgium':'Rob Mc',
'Cameroon':'Geoff',
'Ecuador':'Supriya',
'Nigeria':'Almir',
'Argentina':'Dave',
'Mexico':'Jamie',
'Ghana':'Juan',
'Germany':'Vinit',
'Switzerland':'Joanne',
'Croatia':'Badger',
'Greece':'Jack',
'Chile':'Ian M',
'Honduras':'Ross',
'Ivory Coast':'Ian B',
'Korea Republic':'Mark Debney',
'Netherlands':'Gary',
'Algeria':'Anna',
'France':'Deborah',
'Spain':'Tink',
'Brazil':'Ash',
'Australia':'Peji',
'England':'Justin',
'Iran':'Jess',
'Bosnia and Herzegovina':'Sanjida',
'Russia':'Leonel'
};

$(document).ready(function(){
  var theLoop = function() {
   $("#todaysMatches").empty();
   $("#todaysMatches").append("<img src='images/ajax-loader.gif' /><i>Fetching data</i>");
   todaysMatchesJsonObject = $.ajax({
     url:"http://worldcup.sfg.io/matches/today?by_date=asc",
     error: function() {
       $("#todaysMatches").empty();
       $("#todaysMatches").append("<div class='error'>There was an error retrieving match data from the API. <i>Sucks for you.</i></div>");
     },
     timeout: 8000
   });  
   
   $(document).ajaxComplete(function() {  
     $("#todaysMatches").empty();
     todaysMatches = todaysMatchesJsonObject.responseJSON;
     if (todaysMatches) {
       for (var i = 0; i < todaysMatches.length; i++) {
         var home = todaysMatches[i].home_team;
         var homeGoals = todaysMatches[i].home_team.goals;
         var away = todaysMatches[i].away_team;
         var awayGoals = todaysMatches[i].away_team.goals;
         
         todaysMatches[i].matchAsString = home.country + " <i>"+countryMapper[home.country]+"</i>" + " vs " + away.country + " <i>"+countryMapper[away.country]+"</i>";
         
         var result = "not started"
         
         if (typeof homeGoals === "number") {
           result = homeGoals + " - " + awayGoals;
         }  
            
         var date = moment(new Date(todaysMatches[i].datetime).toUTCString());
         $("#todaysMatches").append("<div class='match'>"
                                      +"<span class='teams'>"
                                      +todaysMatches[i].matchAsString
                                      +"<i>("+result+")</i>" +
                                      +"</span> <span class='time'>"
                                      +date.hours()+":00" + " <i>" + date.fromNow() +"</i>"
                                      +"</span>"
                                 + "</div>");
       } 
     } else {
       console.log("for some reason JQuery went into the 'complete', even tho the ajax request crapped out...");
       $("#todaysMatches").append("<div class='error'>There was an error retrieving match data from the API. <i>Sucks for you.</i></div>");
     }
  });
 };
 theLoop();
 setInterval(theLoop, 300000);
});


</script>

<style>
  body {
    font-family: sans-serif;
    font-weight: bold;
  }
  
  .main {
    color: #559608;
  }
  
  .error {
    color: #cb0000;
  }
  
  .alternative {
    color: #f9cb00
  }
  
  i {
    font-weight: lighter;
    font-style: normal;
    opacity: 0.5;
  }
  
  .match .time {
    color: #559608;
  }
  
  .match .teams {
    color: #f9cb00;
    display: block;
  }
  
  .match {
    padding: 4px;
  }
  
</style>
</head>
<body>

<h2><span class='main'>World Cup <i>2014</i> </span><span class='alternative'>Sky Identity <i>Sweepstake</i></span></h2>
<h3 class='main'><i>Who is playing today?</i></h3>
<div id=todaysMatches>
</div>

</body>
</html>
